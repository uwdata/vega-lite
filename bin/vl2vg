#!/usr/bin/env node

// Compile a Vega-Lite spec to Vega

import {createWriteStream} from 'fs';
import * as vegaLite from '../build/src/index.js';
import compactStringify from 'json-stringify-pretty-compact';
import read from './read.js';
import args from './args.js';

const arg = args('vega');

// load spec, compile vg spec
read(arg._[0]).then(text => compile(JSON.parse(text)));

function compile(vlSpec) {
  // @ts-ignore
  const vgSpec = vegaLite.compile(vlSpec).spec;

  const file = arg._[1] || null;
  const out = file ? createWriteStream(file) : process.stdout;
  if (arg.p) {
    out.write(compactStringify(vgSpec) + '\n');
  } else {
    out.write(JSON.stringify(vgSpec) + '\n');
  }
}
