{
  "$schema": "https://vega.github.io/schema/vega-lite/v2.json",
  "data": {
    "values": [
      {
        "label": "Start",
        "amount": 4000
      },
      {
        "label": "Jan",
        "amount": 1707
      },
      {
        "label": "Feb",
        "amount": -1425
      },
      {
        "label": "Mar",
        "amount": -1030
      },
      {
        "label": "Apr",
        "amount": 1812
      },
      {
        "label": "May",
        "amount": -1067
      },
      {
        "label": "Jun",
        "amount": -1481
      },
      {
        "label": "Jul",
        "amount": 1228
      },
      {
        "label": "Aug",
        "amount": 1176
      },
      {
        "label": "Sep",
        "amount": 1146
      },
      {
        "label": "Oct",
        "amount": 1205
      },
      {
        "label": "Nov",
        "amount": -1388
      },
      {
        "label": "Dec",
        "amount": 1492
      },
      {
        "label": "End",
        "amount": 0
      }
    ]
  },
  "width": 700,
  "height": 450,
  "transform": [
    {
      "window": [
        {
          "op": "sum",
          "field": "amount",
          "as": "sum"
        }
      ]
    },
    {
      "calculate": "datum.label === 'End' ? 0 : datum.sum - datum.amount",
      "as": "previous_amount"
    },
    {
      "calculate": "datum.label === 'End' ? datum.sum : datum.amount",
      "as": "amount"
    },
    {
      "calculate": "datum.amount < 0 ? datum.sum : ''",
      "as": "sum_dec"
    },
    {
      "calculate": "datum.amount > 0 ? datum.sum : ''",
      "as": "sum_inc"
    }
  ],
  "layer": [
    {
      "mark": "bar",
      "encoding": {
        "x": {
          "field": "label",
          "type": "ordinal",
          "sort": null,
          "title": "Months"
        },
        "y": {
          "field": "previous_amount",
          "type": "quantitative",
          "title": "Amount"
        },
        "y2": {
          "field": "sum",
          "type": "quantitative"
        },
        "color": {
          "condition": [
            {
              "test": "datum.label === 'Start' || datum.label === 'End'",
              "value": "#f7e0b6"
            },
            {
              "test": "datum.amount < 0",
              "value": "#f78a64"
            }
          ],
          "value": "#93c4aa"
        }
      }
    },
    {
      "mark": {
        "type": "text",
        "dy": 8,
        "fontWeight": "bold",
        "baseline": "top"
      },
      "encoding": {
        "x": {
          "field": "label",
          "type": "ordinal",
          "sort": null,
          "title": "Months"
        },
        "y": {
          "field": "sum_inc",
          "type": "quantitative"
        },
        "text": {
          "field": "sum_inc",
          "type": "nominal"
        },
        "color": {
          "condition": [
            {
              "test": "datum.label === 'Start' || datum.label === 'End'",
              "value": "#725a30"
            }
          ],
          "value": "#234f39"
        }
      }
    },
    {
      "mark": {
        "type": "text",
        "dy": -8,
        "baseline": "bottom",
        "fontWeight": "bold",
        "color": "#8b422c"
      },
      "encoding": {
        "x": {
          "field": "label",
          "type": "ordinal",
          "sort": null,
          "title": "Months"
        },
        "y": {
          "field": "sum_dec",
          "type": "quantitative"
        },
        "text": {
          "field": "sum_dec",
          "type": "nominal"
        }
      }
    }
  ]
}